<div class="page bg-white">
  <!-- Mailbox Sidebar -->
  <div class="page-aside">
    <div class="page-aside-switch">
      <i class="icon md-chevron-left" aria-hidden="true"></i>
      <i class="icon md-chevron-right" aria-hidden="true"></i>
    </div>
    <div class="page-aside-inner page-aside-scroll">
      <div data-role="container">
        <div data-role="content">
          <section class="page-aside-section">
            <h5 class="page-aside-title">Filtros</h5>
            <form id="form-filtros" class="p-x-25">
              <div class="form-group form-material" data-plugin="formMaterial">
                <input type="text" class="form-control" name="q" placeholder="Buscar por Nome, E-mail, CPF...">
              </div>
              <div class="form-group form-material" data-plugin="formMaterial">
                <select name="idpessoatipo" class="form-control"></select>
              </div>
              <button type="submit" class="btn btn-primary btn-block">Buscar</button>
            </form>
          </section>
        </div>
      </div>
    </div>
    <!---page-aside-inner-->
  </div>
  <!-- Mailbox Content -->
  <div class="page-main">
    <!-- Mailbox Header -->
    <div class="page-header p-0">
      <div class="btn-group" id="actions-buttons">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-md btn-success waves-effect" style="border-radius: 0">
            <i class="icon md-plus " aria-hidden="true"></i>
            <br>
            <span class="text-uppercase hidden-sm-down">cadastrar</span>
          </button>
        </div>
      </div>
    </div>
    <div id="mailContent" class="page-content page-content-table" data-plugin="asSelectable">
      <div style="border-bottom: #e0e0e0 1px solid;">
        <div class="panel panel-bordered overflow-auto" data-auto-height="-245">
          <table id="lista" class="table" data-plugin="animateList" data-animate="fade"
          data-child="tr">
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- pagination -->
      <div id="paginacao"></div>
    </div>
  </div>
</div>
<script>

init.push(function(){

	var panel = System.getPanelApi($("#panel-pagamentos"));

	var $tbody = $("#panel-pagamentos tbody");

	var $tpl = Handlebars.compile($("#tpl-pagamento-row").html());

	function loadPagamentos(){

		$(".refresh").on("click", function(){
			loadPagamentos();
		});

		panel.load();

		rest({
			url:PATH+"/pagamentos/all",
			success:function(r){

				$tbody.html('');

				$.each(r.data, function(index, row){

					$tbody.append($tpl(row));

				});

				initSlidePanel($tbody);

				panel.done();

				$(".btn-excluir-pagamento").on("click", function(e){

					var $btn = $(this);

					var idpagamento = $btn.closest("tr").data("idpagamento");

					System.confirm('Deseja remover o pagamento?', function(b){
				      	if (b) {

					        System.load();

					        rest({
					          url: PATH+"/pagamentos/"+idpagamento,
					          method:'DELETE',
					          success: function(r){

					            System.done();
					            loadPagamentos();
					            System.success("Pagamento exclu√≠do com sucesso");

					          },
					          failure: function(e){
					            System.done();
					            System.showError(e);
					          }
					        });

				      	}
				    });

				});

			},
			failure:function(r){
				System.showError(r);
				panel.done();
			}
		});

	};

	loadPagamentos();

});

</script>