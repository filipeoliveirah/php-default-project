<link rel="stylesheet" href="{$path}/res/theme/material/base/assets/examples/css/apps/media.css">
<style>
  .info-wrap .title {
  text-overflow: ellipsis;
    overflow: hidden;
}
.image-wrap {
  display: table-cell;
    vertical-align: middle;
}


</style>
<div class="page bg-white">
  <!-- Media Sidebar -->
  <div class="page-aside">
    <div class="page-aside-switch">
      <i class="icon md-chevron-left" aria-hidden="true"></i>
      <i class="icon md-chevron-right" aria-hidden="true"></i>
    </div>
    <div class="page-aside-inner page-aside-scroll">
      <div data-role="container">
        <div data-role="content">
          <section class="page-aside-section p-t-0">
            <div class="panel-primary panel-line">
              <div class="panel-heading">
                <h3 class="panel-title">Filtrar Arquivo</h3>
              </div>
              <form id="form-filtros" class="p-x-25">
                <div class="form-group form-material" data-plugin="formMaterial">
                  <label class="form-control-label">Nome do Arquivo</label>
                  <input type="text" class="form-control" name="desarquivo">
                </div>
                <div class="form-group form-material" data-plugin="formMaterial">
                  <label class="form-control-label">Endere√ßo do Arquivo</label>
                  <input type="text" class="form-control" name="desendereco">
                </div>
                <div class="form-group form-material" data-plugin="formMaterial">
                  <label class="form-control-label">Tipo do Arquivo</label>
                  <select name="desextensao" class="form-control">
                    <option value=""> -- SELECIONE -- </option>
                    <option value="jpg">JPG</option>
                    <option value="png">PNG</option>
                    <option value="gif">GIF</option>
                    <option value="pdf">PDF</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Buscar</button>
              </form>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
  <!-- Media Content -->
  <div class="page-main" id="arquivo-page">
    <!-- Media Content Header -->
    <div class="page-header">
      <h1 class="page-title">Arquivos</h1>
    </div>
    <!-- Media Content -->
    <div id="mediaContent" class="page-content page-content-table" data-plugin="asSelectable">
      <!-- Actions -->
      <div class="page-content-actions">
        <div class="pull-xs-right">
          <div class="btn-group media-arrangement" role="group">

            <button class="btn btn-danger" id="btn-excluir" type="button"><i class="icon md-delete" aria-hidden="true"></i></button>
            <button class="btn btn-default active" id="arrangement-grid" type="button"><i class="icon md-view-module" aria-hidden="true"></i></button>
            <button class="btn btn-default" id="arrangement-list" type="button"><i class="icon md-view-list" aria-hidden="true"></i></button>
          </div>
        </div>
        <div class="actions-inner">
          <div class="checkbox-custom checkbox-primary checkbox-lg">
            <input type="checkbox" id="media_all" class="selectable-all">
            <label for="media_all"></label>
          </div>
        </div>
      </div>
      <!-- Media -->

        <div id="paginacao"></div>

        <div id="tab-arquivo-fotos">
          <div data-auto-height="500" class="media-list is-grid p-b-50 overflow-auto" data-plugin="animateList" data-animate="fade"
          data-child="li">
            <ul class="blocks blocks-100 blocks-xxl-4 blocks-xl-3 blocks-lg-4 blocks-md-4 blocks-sm-3"
            data-plugin="animateList" data-child=">li">
             
            </ul>
          </div>
        </div>
    </div>
  </div>
</div>
<div class="site-action">
  <button type="button" id="adicionar" class="site-action-toggle btn-raised btn btn-success btn-floating">
    <i class="front-icon md-upload" aria-hidden="true"></i> Adicionar
  </button>
  <div class="site-action-buttons">
    <button type="button" data-action="download" class="btn-raised btn btn-success btn-floating animation-slide-bottom">
      <i class="icon md-download" aria-hidden="true"></i>
    </button>
    <button type="button" data-action="trash" class="btn-raised btn btn-success btn-floating animation-slide-bottom">
      <i class="icon md-delete" aria-hidden="true"></i>
    </button>
  </div>
  <input type="file" id="fileupload" name="upload" />
</div>

<script id="tpl-arquivo-page" type="text/x-handlebars-template">
<li class="animation-scale-up" style="animation-fill-mode: backwards; animation-duration: 250ms; animation-delay: 0ms;">

  <div class="media-item" data-toggle="slidePanel" data-url="panel.tpl">
    <div class="checkbox-custom checkbox-primary checkbox-lg">
      <input type="checkbox" class="selectable-item" id="media_1" />
      <label for="media_1"></label>
    </div>
    <div class="image-wrap">
      <img class="image img-rounded" src="{$path}{$diretorio}{{desarquivo}}.{{desextensao}}" alt="...">
    </div>
    <div class="info-wrap">
      <div class="title">{{desalias}}</div>
      <div class="time">{{desdtcadastro}}</div>
    </div>
  </div>
</li>
</script>
<script>
init.push(function(){

  $("[name=idarquivo]").combobox({
    url:PATH+"/arquivos",
    displayField:"desarquivo",
    valueField:"idarquivo"
  });

  var panel = System.getPanelApi($('#arquivo-page'));

  var $tplArquivoPage = Handlebars.compile($('#tpl-arquivo-page').html());

  $("#form-filtros [type=submit]").on("click", function(e){
     console.log("ok");
    e.preventDefault();

    carregar();
    
  });

  function carregar(){

    var params = $('#form-filtros').formValues();

    rest({
      url:PATH+"/arquivos",
      data:params,
      success:function(r){

        $("#tab-arquivo-fotos ul").html('');

        $.each(r.data, function(index, arquivo){

          var $li = $($tplArquivoPage(arquivo));

          $li.data('arquivo', arquivo);

          $("#tab-arquivo-fotos ul").append($li);

        });

      },
      failure:function(e){
        System.showError(e);
      }
    });

  }

  carregar();
  
  $("#arrangement-list").on("click", function(){
    
    $(this).addClass('active');
    $("#arrangement-grid").removeClass('active');
    $(".media-list").addClass('is-list').removeClass('is-grid');
    console.log("ok");
  });

  $("#arrangement-grid").on("click", function(){
    
    $(this).addClass('active');
    $("#arrangement-list").removeClass('active');
    $(".media-list").addClass('is-grid').removeClass('is-list');
    
  });

  $("#adicionar").on("click",function(){

    $.upload({
      url:PATH+"/arquivos",
     
      success:function(r){

        carregar();
        System.success("Arquivo adicionado!");

      },
      failure:function(e){
        System.showError(e);
      }
    });

  });

  $("#btn-excluir").on("click", function(){

    var ids = [];

    $("#tab-arquivo-fotos ul li input:checked").each(function(){

      var $li = $(this).closest("li");

      var arquivo = $li.data('arquivo');

      ids.push(arquivo.idarquivo);


    });

    console.log(ids.toString());

    rest({
      url:PATH+"/arquivos",
      method:"DELETE",
      data:{
        ids:ids.toString()
      },
      success:function(){

        $("#tab-arquivo-fotos ul li input:checked").each(function(){
          $(this).closest("li").remove();
        });

      }
    });

  });


});



</script>

