<section id="page-title">

	<div class="container clearfix">
		<h1>Blog</h1>
		<span>Veja nossas Ãºltimas postagens</span>
		<ol class="breadcrumb">
			<li><a href="#">Home</a></li>
			<li class="active">Blog</li>
		</ol>
	</div>

</section><!-- #page-title end -->

<!-- Content
============================================= -->
<section id="content">

	<div class="content-wrap">

		<div class="container clearfix">

			<!-- Post Content
			============================================= -->
			<div class="postcontent nobottommargin clearfix">

				<!-- Posts
				============================================= -->
				<div id="posts">

				</div><!-- #posts end -->

				<!-- Pagination
				============================================= -->
				<div class="pagination"></div>				

			</div><!-- .postcontent end -->

			<!-- Sidebar
			============================================= -->
			<div class="sidebar nobottommargin col_last clearfix">
				<div class="sidebar-widgets-wrap">

					<div class="widget clearfix">

						<h4>Encontre um artigo</h4>
						<div class="input-group form-material">
							<input type="text" class="form-control" placeholder="Digite uma palavra chave" name="despost">
							<div class="input-group-btn">
								<button type="button" class="btn btn-default" id="btn-post-search"><i class="icon md-search" aria-hidden="true"></i></button>
							</div>
						</div>

					</div>

					<div class="widget clearfix categories">

						<h4>Categorias</h4>
						<ul class="list-group">
						  
						</ul>

					</div>

				</div>

			</div><!-- .sidebar end -->

		</div>

	</div>

</section><!-- #content end -->

<script id="tpl-post" type="text/x-handlebars-template">
	
	<div class="entry clearfix">
		<div class="entry-image">
			<a href="images/blog/full/17.jpg" data-lightbox="image"><img class="image_fade" src="{$path}{{descover}}" alt="{{destitle}}"></a>
		</div>
		<div class="entry-title">
			<h2><a href="{$path}{{desurl}}">{{destitle}}</a></h2>
		</div>
		<ul class="entry-meta clearfix">
			<li><i class="icon-calendar3"></i> {{dtpublished}}</li>
			<li><a href="#"><i class="icon-user"></i> {{desauthor}}</a></li>
			<li><i class="icon-folder-open"></i> <a href="#">{{destags}}</a></li>
			<li><a href="blog-single.html#comments"><i class="icon-comments"></i> {{nrcomments}}</a></li>
			<li><a href="#"><i class="icon-camera-retro"></i></a></li>
		</ul>
		<div class="entry-content">
			<p>{{descontentshort}}</p>
			<a href="{$path}/public/blog-posts/{{desurl}}" class="more-link">Leia Mais</a>
		</div>
	</div>

</script>

<script type="text/x-handlebars-template" id="tpl-category">
	<li class="list-group-item">	  
	    <a href="{$path}/public/blog-categories/{{desurl}}">{{descategory}} ({{nrposts}})</a>
	  </li>
</script>

<script>
	
init.push(function(){

	var tpl = {
		post:Handlebars.compile($("#tpl-post").html()),
		category:Handlebars.compile($("#tpl-category").html())
	};

	function loadPosts(page){

		if(!page) page = 1;

		var data = {};

		data.destitle = $("[name=despost]").val();
		data.page = page;
		data.limit = 10;

		var $div = $("#posts");

		rest({
			url:PATH+"/public/blog-posts",
			data:data,
			success:function(r){

				$div.html('');

				$.each(r.data, function(index, row){

					$post = $(tpl.post(row));

					$div.append($post);

				});

				$("#btn-post-search").on("click", function(){

					loadPosts();

				});

				if(r.total > 0){

					var config = $.extend({}, PluginAspaginator.default.getDefaults(), {
						skin:'pagination-gap',
						currentPage:r.currentPage,
						itemsPerPage:r.itemsPerPage,
						onChange:function(page){
							loadPosts(page)
						}
					});

					$("#pagination").show().asPaginator(r.total, config);

				}else{
					$("#pagination").hide();
				}

			},
			failure:function(r){
				console.error(r);
			}
		});

	}

	function loadCategories(){

		var $ul = $(".categories ul.list-group");

		rest({
			url:PATH+"/public/blog-categories",
			success:function(r){

				$ul.html('');

				$.each(r.data, function(index, row){

					$li = $(tpl.category(row));

					$ul.append($li);

				});

			},
			failure:function(r){
				System.showError(r);
			}
		});

	}

	loadPosts();
	loadCategories();

});

</script>