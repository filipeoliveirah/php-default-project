<style>@media (max-width: 768px) {
    .p-xs-25 {
      padding: 25px!important;
    }
  }</style><div id="pessoa-panel"><header class="slidePanel-header"><div class="overlay-top overlay-panel overlay-background bg-indigo-600"><div class="slidePanel-actions btn-group btn-group-flat" aria-label="actions" role="group"><button id="btn-delete-pessoa" type="button" class="btn btn-pure icon md-delete waves-effect" aria-hidden="true"></button> <button id="btn-close-slidepanel" type="button" class="btn btn-pure slidePanel-close icon md-close" aria-hidden="true"></button></div><h4 class="stage-name"><h5 class="taskboard-stage-title text-uppercase">{$pessoa.despessoa}</h5></h4></div></header><div class="slidePanel-inner p-0"><section class="slidePanel-inner-section p-0 m-0"><div class="panel nav-tabs-horizontal nav-tabs-inverse" id="pessoa-tabs" data-plugin="tabs"><div class="panel-heading panel-heading-tab" style="border-radius: 0"><ul class="nav nav-tabs nav-tabs-solid" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#tab-pessoa-home" aria-controls="tab-pessoa-home" role="tab" aria-expanded="true">Home</a><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#tab-pessoa-faleconosco" aria-controls="tab-pessoa-faleconosco" role="tab">Fale Conosco</a></ul></div><div class="panel-body p-0"><div class="tab-content"><div class="tab-pane active" id="tab-pessoa-home" role="tabpanel"><div class="card"><div class="card-header bg-white p-30 clearfix"><a id="pessoa-photo" class="avatar avatar-100 pull-xs-left m-r-20" href="javascript:void(0)"><img src="{$pessoa.desphotourl}" alt="Foto de {$pessoa.desprimeironome}"></a><div class="pull-xs-left"><div class="font-size-20 m-b-15">{$pessoa.despessoa}</div>{if="strlen($endereco.desenderecoresumido) > 0"}<p class="m-b-5 text-nowrap"><i class="icon md-pin m-r-10" aria-hidden="true"></i> <span class="text-break">{$endereco.desenderecoresumido}</span></p>{/if} {if="strlen($pessoa.desemail) > 0"}<p class="m-b-5 text-nowrap"><i class="icon md-email m-r-10" aria-hidden="true"></i> <span class="text-break">{$pessoa.desemail}</span></p>{/if} {if="isset($cpf.desdocumentoformatado) &&strlen($cpf.desdocumentoformatado) > 0"}<p class="m-b-5 text-nowrap"><i class="icon md-balance-wallet m-r-10" aria-hidden="true"></i> <span class="text-break">{$cpf.desdocumentoformatado}</span></p>{/if} {if="isset($cnpj.desdocumentoformatado) && strlen($cnpj.desdocumentoformatado) > 0"}<p class="m-b-5 text-nowrap"><i class="icon md-balance-wallet m-r-10" aria-hidden="true"></i> <span class="text-break">{$cnpj.desdocumentoformatado}</span></p>{/if}</div></div></div></div><div class="tab-pane active" id="tab-pessoa-faleconosco" role="tabpanel"></div></div></div></div></section></div></div><script>var PessoaPanel = (function(data, selectorContainer, opts){

  var t = this;

  var defaults = {
    debug:false
  };

  var o = $.extend({}, defaults, opts);

  t.$el = $(selectorContainer);
  t.id = 0;

  t.deletePessoa = function(){

    System.confirm("Deseja realmente excluir o cadastro de "+data.despessoa+" definitivamente? Todos os dados associados serão excluídos.", function(r, s, f){

      if (r) {

        rest({
          url:PATH+"/pessoas/"+data.idpessoa,
          method:"DELETE",
          success:function(){
            s();
            data = {};
            $("#btn-close-slidepanel").trigger("click");
          },
          failure:function(e){
            System.showError(e);
            f(e.error);
          }
        });

      } else {

        f();

      }

    });

  };

  t.uploadPhoto = function(){

    $.upload({
      url:PATH+"/pessoas/"+data.idpessoa+"/photo",
      success:function(r){

        if (r.data.desphotourl) {
          t.$el.find('#pessoa-photo').find('img').attr('src', PATH+r.data.desphotourl);
        }

      },
      failure:function(e){
        System.showError(e);
      }
    });

  };

  t.init = function(){

    t.$el.on('click', '#btn-delete-pessoa', function(){

      t.deletePessoa();

    });

    t.$el.on('click', '#pessoa-photo', function(){

      t.uploadPhoto();

    });

  };

  t.init();

});

var pessoa = JSON.parse('{function="json_encode($pessoa)"}');  
var pessoaPanel = new PessoaPanel(pessoa, '#pessoa-panel');</script>