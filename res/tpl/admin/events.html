<div class="page"><div class="page-aside"><div class="page-aside-switch"><i class="icon md-chevron-left" aria-hidden="true"></i> <i class="icon md-chevron-right" aria-hidden="true"></i></div><div class="page-aside-inner page-aside-scroll"><div data-role="container"><div data-role="content"><section class="page-aside-section"><div class="p-x-20"><div class="form-group form-material"><label class="form-control-label" for="select">Local</label><select class="form-control" id="select"><option>1<option>2<option>3<option>4<option>5</select></div><button type="button" class="btn btn-block btn-primary">Filtrar</button></div></section><section class="page-aside-section"><h5 class="page-aside-title">Eventos</h5><div class="list-group calendar-list"><a class="list-group-item calendar-event" data-title="Meeting" data-stick="true" data-color="red-600" href="javascript:void(0)"><i class="md-circle red-600 m-r-10" aria-hidden="true"></i>Meeting </a><a class="list-group-item calendar-event" data-title="Birthday Party" data-stick="true" data-color="green-600" href="javascript:void(0)"><i class="md-circle green-600 m-r-10" aria-hidden="true"></i>Birthday Party </a><a class="list-group-item calendar-event" data-title="Call Jimba" data-stick="true" data-color="orange-600" href="javascript:void(0)"><i class="md-circle orange-600 m-r-10" aria-hidden="true"></i>Call Jimba </a><a class="list-group-item calendar-event" data-title="Dinner with Team" data-stick="true" data-color="cyan-600" href="javascript:void(0)"><i class="md-circle cyan-600 m-r-10" aria-hidden="true"></i>Dinner with Team </a><a id="addNewEventBtn" class="list-group-item" href="javascript:void(0)"><i class="icon md-plus" aria-hidden="true"></i> Add New Event</a></div></section></div></div></div></div><div class="page-main"><div class="page-content"><div class="row"><div class="col-xs-12 col-md-12"><div class="panel panel-shadow panel-primary panel-line panel-calendar"><div class="panel-heading"><h3 class="panel-title">Calend√°rio de Eventos</h3><div class="panel-actions"><button type="button" class="btn btn-success"><i class="icon md-plus" aria-hidden="true"></i>Novo Evento</button></div></div><div class="panel-body" data-auto-height="-190"><div class="calendar-container p-0"><div id="calendar"></div></div></div></div></div></div></div></div></div><script>init.push(function(){

	var myEvents = [];

  var myOptions = {
    header: {
      left: null,
      center: 'prev,title,next',
      right: 'month,agendaWeek,agendaDay'
    },

    navLinks: true,
    selectable: true,
    selectHelper: true,
    select: function(start, end) {

      var dtstart = moment(new Date(start._d));

      dtstart.add(1, "days");

      console.log(dtstart.format("YYYY-MM-DD"));

      var dtend = moment(new Date(end._d));

      console.log(dtend.format("YYYY-MM-DD"));

      // console.log(start._d, end._d);

      $('#addNewEvent').modal('show');
    },

    editable: true,
    eventLimit: true,
    windowResize: function windowResize(view) {
      var width = $(window).outerWidth();
      var options = Object.assign({}, myOptions);
      options.events = view.calendar.getEventCache();
      options.aspectRatio = width < 667 ? 0.5 : 1.35;

      $('#calendar').fullCalendar('destroy');
      $('#calendar').fullCalendar(options);
    },
    eventClick: function (event) {
      var color = event.backgroundColor ? event.backgroundColor : Config.colors('blue', 600);
      $('#editEname').val(event.title);

      if (event.start) {
        $('#editStarts').datepicker('update', event.start._d);
      } else {
        $('#editStarts').datepicker('update', '');
      }
      if (event.end) {
        $('#editEnds').datepicker('update', event.end._d);
      } else {
        $('#editEnds').datepicker('update', '');
      }

      $('#editColor [type=radio]').each(function () {
        var $this = $(this),
            _value = $this.data('color').split('|'),
            value = Config.colors(_value[0], _value[1]);
        if (value === color) {
          $this.prop('checked', true);
        } else {
          $this.prop('checked', false);
        }
      });

      $('#editNewEvent').modal('show').on('hidden.bs.modal', function (e) {
        event.title = $('#editEname').val();

        var color = $('#editColor [type=radio]:checked').data('color').split('|');
        color = Config.colors(color[0], color[1]);
        event.backgroundColor = color;
        event.borderColor = color;

        event.start = new Date($('#editStarts').data('datepicker').getDate());
        event.end = new Date($('#editEnds').data('datepicker').getDate());
        $('#calendar').fullCalendar('updateEvent', event);
      });
    },
    dayClick: function(date, jsEvent, view){
      console.log(date);
    },
    eventDragStart: function eventDragStart() {
      $('.site-action').data('actionBtn').show();
    },
    eventDragStop: function eventDragStop() {
      $('.site-action').data('actionBtn').hide();
    },

    events: myEvents,
    droppable: true
  };

  var _options = void 0;
  var myOptionsMobile = Object.assign({}, myOptions);

  myOptionsMobile.aspectRatio = 0.5;
  _options = $(window).outerWidth() < 667 ? myOptionsMobile : myOptions;

  function loadEvents(){

    var $panel = System.getPanelApi($(".panel-calendar"));

    $panel.load();

    rest({
      url:PATH+"/events/all",
      success:function(r){

        $.each(r.data, function(index, row){



        });

      },
      failure:function(r){
        $panel.done();
        System.showError(r);
      }
    });

  }

  $('#editNewEvent').modal();
  $('#calendar').fullCalendar(_options);

});</script>